<div class="container-fluid">
  <div class="row">
    <div class="col-md-8">
<mat-stepper [linear]="true" #stepper [disableRipple]="true" class="custom-stepper">

        <!-- Step 1: Address Info -->
        <mat-step [stepControl]="addressForm">
          <form  [formGroup]="addressForm" class="p-3">
            <ng-template matStepLabel>Address Information</ng-template>

            <div class="d-flex justify-content-between align-items-center mb-3">
              <h5 class="mb-0 fw-bold text-primary">Your Delivery Address</h5>
              <button mat-stroked-button color="accent" type="button" (click)="saveAsNewAddress()">
                <mat-icon class="me-1">save</mat-icon>
                Save as Main Address
              </button>
            </div>

            <mat-form-field appearance="outline" class="w-100 mb-3">
              <mat-label>Street</mat-label>
              <input matInput formControlName="street" placeholder="Ex. 123 Main St" required />
              <mat-error *ngIf="addressForm.get('street')?.invalid && addressForm.get('street')?.touched">
                Street is required
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="w-100 mb-3">
              <mat-label>City</mat-label>
              <input matInput formControlName="city" placeholder="Ex. New York" required />
              <mat-error *ngIf="addressForm.get('city')?.invalid && addressForm.get('city')?.touched">
                City is required
              </mat-error>
            </mat-form-field>

            <div class="row">
              <div class="col-md-6">
                <mat-form-field appearance="outline" class="w-100 mb-3">
                  <mat-label>State</mat-label>
                  <input matInput formControlName="state" placeholder="Ex. NY" required />
                  <mat-error *ngIf="addressForm.get('state')?.invalid && addressForm.get('state')?.touched">
                    State is required
                  </mat-error>
                </mat-form-field>
              </div>

              <div class="col-md-6">
                <mat-form-field appearance="outline" class="w-100 mb-3">
                  <mat-label>Zip Code</mat-label>
                  <input matInput formControlName="zipCode" placeholder="Ex. 10001" required />
                  <mat-error *ngIf="addressForm.get('zipCode')?.invalid && addressForm.get('zipCode')?.touched">
                    Zip Code is required
                  </mat-error>
                </mat-form-field>
              </div>
            </div>

            <mat-form-field appearance="outline" class="w-100 mb-3">
              <mat-label>Country</mat-label>
              <input matInput formControlName="country" placeholder="Ex. USA" required />
              <mat-error *ngIf="addressForm.get('country')?.invalid && addressForm.get('country')?.touched">
                Country is required
              </mat-error>
            </mat-form-field>

            <div class="mt-4 d-flex justify-content-end">
              <button mat-raised-button color="primary" type="button" (click)="saveAsDeliveryAddress()"
                [disabled]="addressForm.invalid" matStepperNext>
                Next
                <mat-icon class="ms-1">arrow_forward</mat-icon>
              </button>
            </div>
          </form>
        </mat-step>


        <!-- Step 2: Test -->
        <mat-step>
          <ng-template matStepLabel>Choose Delivery Method</ng-template>

          <div class="mt-3">
            <mat-radio-group [(ngModel)]="order.deliveryMethodId" name="deliveryMethod" class="w-100">
              @for (deliveryMethod of deliveryMethods; track $index) {
              <mat-card class="mb-3 p-3 d-flex justify-content-between align-items-center delivery-option"
                (click)="order.deliveryMethodId = deliveryMethod.id">
                <div>
                  <mat-radio-button [value]="deliveryMethod.id" class="me-3">
                    <strong>{{ deliveryMethod.name }}</strong>
                  </mat-radio-button>
                  <div class="text-muted small">
                    Estimated Delivery: {{ deliveryMethod.deliveryTimeInDays }} days
                  </div>
                </div>
                <div class="fw-bold text-primary">
                  {{ deliveryMethod.price | currency:'EGP' }}
                </div>
              </mat-card>
              }
            </mat-radio-group>
          </div>

          <div class="mt-4 d-flex justify-content-between">
            <button mat-stroked-button color="accent" matStepperPrevious>Back</button>
            <button (click)="updateDeliveryMethods(order.deliveryMethodId!)" mat-raised-button color="primary" matStepperNext [disabled]="!order.deliveryMethodId">
              Next
            </button>
          </div>
        </mat-step>


        <!-- Step 3: Test -->
         <!-- Stripe -->
        <mat-step>
    
  <ng-template matStepLabel>Payment</ng-template>

  <div id="card-element" class="p-3 border rounded mb-3"></div>
  <div *ngIf="paymentError" class="text-danger">{{ paymentError }}</div>

  <div class="d-flex justify-content-between mt-3">
    <button mat-stroked-button color="accent" matStepperPrevious>Back</button>
    <button mat-raised-button color="primary" (click)="submitPayment()">Pay</button>
  </div>
</mat-step>

          <!-- <div class="mt-3 d-flex justify-content-between">
            <button mat-stroked-button color="accent" matStepperPrevious>Back</button>
            <button mat-raised-button color="primary" matStepperNext>Next</button>
          </div> -->


      </mat-stepper>
    </div>

    <div class="col-md-4">
      <app-order-summary></app-order-summary>
    </div>
  </div>
</div>